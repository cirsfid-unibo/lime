/**
 * plugin.js
 *
 * Released under LGPL License.
 * Copyright (c) 2015 Matthias Musialowski
 */
tinymce.PluginManager.requireLangPack("magicline","es,fr_FR,it,ro,ru"),tinymce.PluginManager.add("magicline",function(e,t){if("string"==typeof e.settings.valid_classes)e.settings.valid_classes+=" nomagicline"
else if("object"==typeof e.settings.valid_classes){var i=e.settings.valid_classes["*"]
e.settings.valid_classes["*"]=void 0!=i?i+" nomagicline":"nomagicline"}e.on("init",function(){function i(e,t){d=parseInt(C.getStyle(e,"border-left-width",!0)),c=parseInt(C.getStyle(e,"border-right-width",!0)),l=parseInt(C.getStyle(e,"padding-left",!0)),g=parseInt(C.getStyle(e,"padding-right",!0)),S=t-z,w=C.getPos(e,D).x,k=C.getSize(e).w,w+=l,k-=l+g,v&&(S-=I),e===D?k-=d+c:(w+=d,k-=d+c,v&&(w-=parseInt(C.getStyle(D,"border-left-width",!0))))}function n(e){if(o=E(e.target),!(o.hasClass("magicline-container")||o.parent(".magicline-container").length>0)){for(f=!1;o.length>0&&o[0]!=D;){if(!o.hasClass("nomagicline")&&!o.attr("data-nomagicline")&&P.indexOf(o[0].tagName)>-1){f=!0,r=o
break}o=o.parent()}if(f){if(v="border-box"===C.getStyle(D,"box-sizing",!0),I=parseInt(C.getStyle(D,"border-top-width",!0)),h=C.getPos(o[0],D),b=C.getSize(o[0]),u=e.pageY,N&&(u-=C.getPos(D).y),v||(u-=I),Math.abs(h.y-u)<=z)return p=o.prev(),void((0==p.length||p.hasClass("magicline-container")||P.indexOf(p[0].tagName)>-1)&&(y="top",i(o.parent()[0],h.y),(!D.contains(s)||C.getParents(s).length<=1)&&a(),C.setStyles(s,{top:S+"px",left:w+"px",width:k+"px"}),C.show(s)))
if(Math.abs(h.y+b.h-u)<=z)return m=o.next(),void((0==m.length||m.hasClass("magicline-container")||P.indexOf(m[0].tagName)>-1)&&(y="bottom",i(o.parent()[0],h.y+b.h),(!D.contains(s)||C.getParents(s).length<=1)&&a(),C.setStyles(s,{top:S+"px",left:w+"px",width:k+"px"}),C.show(s)))}C.hide(s)}}function a(){s&&C.remove(s),s=C.create("div",{class:"magicline-container",style:"width: 100%; position: absolute; display: block; top: 0; left: 0; margin: 0; padding: 0; height: "+2*z+"px;-webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;",contentEditable:"false","data-mce-bogus":"1"}),C.add(s,"div",{class:"magicline-dashedline",style:"position:absolute; top: 50%; left: 0; display: block; border: 0; border-top: 1px dashed "+_+"; height: 0; width: 100%; margin: 0; padding: 0;","data-mce-bogus":"1"})
var i=C.add(s,"div",{class:"magicline-bt_insert",style:'position: absolute; top: 50%; right: 25px; height: 16px; width: 16px; margin: 0; padding: 0; margin-top: -7px;font-size: 0;color: white; background: url("'+t+'/img/icon.png") center no-repeat '+_+";cursor: pointer; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;",title:tinymce.util.I18n.translate("Insert paragraph here"),contentEditable:"false","data-mce-bogus":"1"})
C.add(s,"div",{class:"magicline-arrow-left",style:"display: block; position: absolute; left: 0; top: 50%; height: 0; width: 0; margin: 0; padding: 0; margin-top: -7px;border: 8px solid transparent; border-left-color: "+_+";",contentEditable:"false","data-mce-bogus":"1"}),C.add(s,"div",{class:"magicline-arrow-right",style:"display: block; position: absolute; right: 0; top: 50%; height: 0; width: 0; margin: 0; padding: 0; margin-top: -7px;border: 8px solid transparent; border-right-color: "+_+";",contentEditable:"false","data-mce-bogus":"1"}),C.bind(s,"click",function(t){if(t.target===i){e.focus(!1)
var n=C.create(M,{},'<br data-mce-bogus="1">')
"top"===y?r.before(n):r.after(n),e.selection.select(n,!0)}C.hide(s)}),C.hide(s),C.add(D,s)}var s,o,r,l,g,d,c,p,m,h,b,u,f,y,x,v,w,S,k,I,_=e.settings.magicline_color||"#4A8DE0",P=e.settings.magicline_targetedItems||["DIV","IMG"],z=e.settings.magicline_triggerMargin||20,M=e.settings.magicline_insertedBlockTag||"p",E=tinymce.dom.DomQuery,C=e.dom,D=e.$()[0],N=e.settings.inline===!0
C.setStyle(D,"position","relative"),a(),e.$().on("mousemove",function(e){clearTimeout(x),x=setTimeout(function(){n(e)},25)})})})
